<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Monaco Recorder Demo</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        background: #1e1e1e;
        color: #f0f0f0;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', sans-serif;
        height: 100vh;
        display: flex;
        flex-direction: column;
      }
      
      .header {
        padding: 20px;
        text-align: center;
        background: #252526;
        border-bottom: 1px solid #333;
      }
      
      h1 {
        margin: 0;
        color: #4a90e2;
      }
      
      .container {
        display: flex;
        flex: 1;
        overflow: hidden;
      }
      
      .editor-container {
        flex: 1;
        position: relative;
      }
      
      #editor {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
      }
      
      .controls {
        padding: 15px;
        background: #252526;
        border-top: 1px solid #333;
        display: flex;
        justify-content: center;
        gap: 15px;
      }
      
      button {
        background: #4a90e2;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }
      
      button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      
      .status {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      
      .status-indicator {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: #666;
      }
      
      .status-indicator.recording {
        background: #ff4444;
        box-shadow: 0 0 10px #ff4444;
      }
      
      .status-indicator.playing {
        background: #44ff44;
        box-shadow: 0 0 10px #44ff44;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>Monaco Recorder Demo</h1>
    </div>
    
    <div class="container">
      <div class="editor-container">
        <div id="editor"></div>
      </div>
    </div>
    
    <div class="controls">
      <div class="status">
        <div id="statusIndicator" class="status-indicator"></div>
        <span id="statusText">Ready</span>
      </div>
    </div>

    <script src="https://unpkg.com/monaco-editor@0.45.0/min/vs/loader.js"></script>
    <script>
      // Monaco configuration
      require.config({ 
        paths: { 
          vs: 'https://unpkg.com/monaco-editor@0.45.0/min/vs',
          'vs/language/typescript': 'https://unpkg.com/monaco-editor@0.45.0/min/vs/language/typescript'
        }
      });
      
      // Demo content
      const demos = [
        {
          name: 'TypeScript Features',
          language: 'typescript',
          code: `// TypeScript Demo
interface User {
  id: number;
  name: string;
  role: 'admin' | 'user' | 'guest';
  lastLogin?: Date;
}

class UserManager {
  private users: User[] = [];
  
  addUser(user: Omit<User, 'id'>) {
    const newUser = { ...user, id: Date.now() };
    this.users.push(newUser);
    return newUser;
  }
  
  findUsers(predicate: (user: User) => boolean) {
    return this.users.filter(predicate);
  }
}

// Try these features:
// 1. Hover over types
// 2. Try autocompletion (Ctrl+Space)
// 3. Right-click for refactoring
// 4. See type errors in real-time`
        },
        {
          name: 'React Component',
          language: 'typescript',
          code: `// React Component Demo
import React, { useState } from 'react';

interface Todo {
  id: number;
  text: string;
  completed: boolean;
}

const TodoApp: React.FC = () => {
  const [todos, setTodos] = useState<Todo[]>([]);
  const [input, setInput] = useState('');

  const addTodo = (e: React.FormEvent) => {
    e.preventDefault();
    if (!input.trim()) return;
    
    setTodos([...todos, {
      id: Date.now(),
      text: input,
      completed: false
    }]);
    setInput('');
  };

  const toggleTodo = (id: number) => {
    setTodos(todos.map(todo => 
      todo.id === id ? { ...todo, completed: !todo.completed } : todo
    ));
  };

  return (
    <div className="todo-app">
      <h1>Todo App</h1>
      <form onSubmit={addTodo}>
        <input
          value={input}
          onChange={(e) => setInput(e.target.value)}
          placeholder="Add a todo..."
        />
        <button type="submit">Add</button>
      </form>
      <ul>
        {todos.map(todo => (
          <li 
            key={todo.id} 
            style={{ textDecoration: todo.completed ? 'line-through' : 'none' }}
            onClick={() => toggleTodo(todo.id)}
          >
            {todo.text}
          </li>
        ))}
      </ul>
    </div>
  );
};

// Try these features:
// 1. JSX syntax highlighting
// 2. TypeScript with React types
// 3. Component props completion`
        }
      ];
      
      // Initialize the editor
      let editor;
      let currentDemoIndex = 0;
      let isPlaying = false;
      let playbackTimeout;
      
      require(['vs/editor/editor.main'], function() {
        // Create editor
        editor = monaco.editor.create(document.getElementById('editor'), {
          value: '// Loading demo...\n',
          language: 'typescript',
          theme: 'vs-dark',
          minimap: { enabled: true },
          automaticLayout: true,
          fontSize: 14,
          lineNumbers: 'on',
          roundedSelection: true,
          scrollBeyondLastLine: false,
          readOnly: true,
          tabSize: 2
        });
        
        // Start the demo
        loadDemo(0);
      });
      
      function updateStatus(text, type = '') {
        const indicator = document.getElementById('statusIndicator');
        const statusText = document.getElementById('statusText');
        
        indicator.className = 'status-indicator' + (type ? ' ' + type : '');
        statusText.textContent = text;
      }
      
      function loadDemo(index) {
        if (index >= demos.length) {
          index = 0;
        }
        currentDemoIndex = index;
        const demo = demos[index];
        
        // Set editor content and language
        const model = monaco.editor.createModel(
          demo.code,
          demo.language
        );
        
        editor.setModel(model);
        updateStatus(`Demo: ${demo.name}`);
        
        // Auto-start playback after a short delay
        setTimeout(startPlayback, 2000);
      }
      
      function startPlayback() {
        if (isPlaying) return;
        isPlaying = true;
        updateStatus('Playing demo...', 'playing');
        
        // Simulate user interactions
        const demo = demos[currentDemoIndex];
        const code = demo.code;
        let i = 0;
        
        function type() {
          if (i < code.length) {
            const currentValue = editor.getValue();
            const newValue = code.substring(0, i + 1);
            
            // Only update if the content has changed
            if (currentValue !== newValue) {
              editor.setValue(newValue);
              
              // Scroll to the end
              const lineNumber = editor.getModel().getLineCount();
              editor.revealLineInCenter(lineNumber);
            }
            
            i++;
            const speed = 10 + Math.random() * 10; // Variable speed for more natural feel
            playbackTimeout = setTimeout(type, speed);
          } else {
            // Demo complete, move to next one after a delay
            playbackTimeout = setTimeout(() => {
              loadDemo(currentDemoIndex + 1);
              isPlaying = false;
            }, 3000);
          }
        }
        
        type();
      }
      
      // Clean up on page unload
      window.addEventListener('beforeunload', () => {
        if (playbackTimeout) {
          clearTimeout(playbackTimeout);
        }
      });
    </script>
  </body>
</html>
