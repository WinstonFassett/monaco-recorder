<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Monaco Editor Auto Demo</title>
    <style>
      html, body { 
        height: 100%; 
        margin: 0; 
        font-family: -apple-system, sans-serif; 
        background: #1e1e1e; 
        color: #f0f0f0; 
      }
      #toolbar { 
        padding: 12px; 
        border-bottom: 1px solid #444; 
        display: flex; 
        gap: 12px; 
        align-items: center; 
      }
      #editor { 
        position: absolute; 
        top: 60px; 
        bottom: 0; 
        left: 0; 
        right: 0; 
      }
      button { 
        background: #4a90e2; 
        color: white; 
        border: none; 
        padding: 8px 16px; 
        border-radius: 4px; 
        cursor: pointer;
        font-size: 14px;
      }
      button:disabled { 
        background: #555; 
        color: #aaa; 
        cursor: not-allowed;
      }
      .controls {
        display: flex;
        gap: 12px;
        align-items: center;
      }
      .speed-control {
        display: flex;
        align-items: center;
        gap: 8px;
      }
    </style>
  </head>
  <body>
    <div id="toolbar">
      <h2 style="margin: 0; color: #4a90e2;">Monaco Editor Demo</h2>
      <div class="controls">
        <button id="startBtn">▶ Start Demo</button>
        <button id="pauseBtn" disabled>⏸ Pause</button>
        <div class="speed-control">
          <span>Speed:</span>
          <input type="range" id="speed" min="1" max="10" value="5">
        </div>
      </div>
    </div>
    <div id="editor"></div>

    <script>
      // Load Monaco
      const script = document.createElement('script');
      script.src = 'https://unpkg.com/monaco-editor@0.45.0/min/vs/loader.js';
      script.onload = () => {
        window.require.config({ 
          paths: { 
            vs: 'https://unpkg.com/monaco-editor@0.45.0/min/vs',
            'vs/language/typescript': 'https://unpkg.com/monaco-editor@0.45.0/min/vs/language/typescript'
          }
        });
        window.require(['vs/editor/editor.main'], initDemo);
      };
      document.head.appendChild(script);

      // Demo content
      const demoContent = [
        { text: '// Welcome to Monaco Editor Demo\n', pause: 1000 },
        { text: '// This demo will show TypeScript features in action\n\n', pause: 1000 },
        { text: 'interface User {\n  id: number;\n  name: string;\n  email: string;\n  role: ', action: 'complete', options: ['admin', 'user', 'guest'], selected: 0 },
        { text: ';\n  lastLogin?: Date;\n}\n\n', pause: 1000 },
        { text: 'class UserManager {\n  private users: User[] = [];\n\n  addUser(user: Omit<User, ', action: 'complete', options: ['id', 'name', 'email', 'role'], selected: 0 },
        { text: '>) {\n    const newUser = {\n      ...user,\n      id: ', action: 'complete', options: ['Date.now()', 'Math.random()', 'this.users.length + 1'], selected: 0 },
        { text: '\n    };\n    this.users.push(newUser);\n    return newUser;\n  }\n\n  findUsers(predicate: (user: User) => boolean) {\n    return this.users.filter(predicate);\n  }\n}\n\n', pause: 1000 },
        { text: '// Example usage\nconst manager = new UserManager();\n\n', pause: 500 },
        { text: 'manager.addUser({\n  name: ', action: 'type', text: '"', pause: 200, text: 'Admin', pause: 200, text: '"' },
        { text: ',\n  email: ', action: 'type', text: '"', pause: 200, text: 'admin@example.com', pause: 200, text: '"' },
        { text: ',\n  role: ', action: 'complete', options: ['admin', 'user', 'guest'], selected: 0 },
        { text: '\n});\n\n', pause: 1000 },
        { text: 'const admins = manager.findUsers(user => user.role === ', action: 'complete', options: ['admin', 'user', 'guest'], selected: 0 },
        { text: ');\n', pause: 1000 },
        { text: 'console.log(admins);\n', pause: 2000 },
        { text: '// Try hovering over variables to see type information\n// Use Ctrl+Space for autocompletion\n// Right-click for refactoring options', pause: 0 }
      ];

      // Demo state
      let editor;
      let currentStep = 0;
      let isPlaying = false;
      let timeoutId;

      async function initDemo() {
        // Create editor
        editor = monaco.editor.create(document.getElementById('editor'), {
          value: '',
          language: 'typescript',
          theme: 'vs-dark',
          minimap: { enabled: true },
          automaticLayout: true,
          fontSize: 14,
          lineNumbers: 'on',
          roundedSelection: true,
          scrollBeyondLastLine: false,
          readOnly: false,
          tabSize: 2
        });

        // Set up controls
        const startBtn = document.getElementById('startBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const speedControl = document.getElementById('speed');
        
        startBtn.addEventListener('click', () => {
          if (isPlaying) return;
          isPlaying = true;
          startBtn.disabled = true;
          pauseBtn.disabled = false;
          playDemo();
        });

        pauseBtn.addEventListener('click', () => {
          isPlaying = false;
          clearTimeout(timeoutId);
          startBtn.disabled = false;
          pauseBtn.disabled = true;
        });

        speedControl.addEventListener('input', (e) => {
          // Update speed
        });

        // Start demo automatically after a short delay
        setTimeout(() => {
          startBtn.click();
        }, 1000);
      }

      function getSpeed() {
        const speed = parseInt(document.getElementById('speed').value);
        return Math.max(1000 / speed, 50); // Convert to ms per character
      }

      function typeText(text, onComplete) {
        let i = 0;
        const speed = getSpeed();
        
        function type() {
          if (i < text.length) {
            const currentText = editor.getValue();
            editor.setValue(currentText + text.charAt(i));
            i++;
            if (isPlaying) {
              timeoutId = setTimeout(type, speed);
            }
          } else if (onComplete) {
            onComplete();
          }
        }
        
        type();
      }

      function showCompletion(options, onSelect) {
        // Simulate user typing to trigger completion
        const currentText = editor.getValue();
        editor.setValue(currentText + ' ');
        
        // Move cursor back
        const position = editor.getPosition();
        editor.setPosition({
          lineNumber: position.lineNumber,
          column: position.column - 1
        });
        
        // Simulate completion selection after a short delay
        setTimeout(() => {
          const selected = options[0];
          const currentLine = editor.getModel().getLineContent(position.lineNumber);
          const newLine = currentLine.replace(/\s*$/, ' ' + selected);
          
          editor.executeEdits('demo', [{
            range: {
              startLineNumber: position.lineNumber,
              startColumn: 1,
              endLineNumber: position.lineNumber,
              endColumn: position.column + 1
            },
            text: newLine,
            forceMoveMarkers: true
          }]);
          
          // Move cursor to end of line
          const newPosition = {
            lineNumber: position.lineNumber,
            column: newLine.length + 1
          };
          editor.setPosition(newPosition);
          
          if (onSelect) onSelect(selected);
        }, 500);
      }

      function playStep(stepIndex) {
        if (stepIndex >= demoContent.length) {
          isPlaying = false;
          document.getElementById('startBtn').disabled = false;
          document.getElementById('pauseBtn').disabled = true;
          return;
        }

        const step = demoContent[stepIndex];
        
        if (step.action === 'complete') {
          showCompletion(step.options, (selected) => {
            const nextStep = step.selected !== undefined ? step.selected + 1 : 0;
            if (nextStep < step.options.length) {
              // If there are more options to cycle through
              demoContent[stepIndex].selected = nextStep;
              playStep(stepIndex);
            } else {
              // Move to next step after a delay
              setTimeout(() => playStep(stepIndex + 1), step.pause || 1000);
            }
          });
        } else if (step.action === 'type') {
          typeText(step.text, () => {
            if (step.pause) {
              setTimeout(() => playStep(stepIndex + 1), step.pause);
            } else {
              playStep(stepIndex + 1);
            }
          });
        } else {
          // Regular text typing
          typeText(step.text, () => {
            if (step.pause) {
              setTimeout(() => playStep(stepIndex + 1), step.pause);
            } else {
              playStep(stepIndex + 1);
            }
          });
        }
      }

      function playDemo() {
        if (!isPlaying) return;
        currentStep = 0;
        editor.setValue('');
        playStep(0);
      }
    </script>
  </body>
</html>
