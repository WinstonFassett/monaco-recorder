<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Monaco Recorder Demos</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs/editor/editor.main.min.css">
    <style>
      body { 
        font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica, Arial, sans-serif; 
        max-width: 1200px; 
        margin: 0 auto; 
        padding: 40px 20px;
        line-height: 1.6;
        background-color: #1e1e1e;
        color: #f0f0f0;
      }
      h1 {  margin-bottom: 0.5em; }
      h2 { color: #cccccc; border-bottom: 2px solid #444; padding-bottom: 0.5em; }
      .demo-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 30px 0; }
      .demo-card { 
        border: 1px solid #444;
        border-radius: 8px; 
        padding: 20px; 
        text-decoration: none; 
        color: inherit;
        background-color: #2a2a2a;
        transition: box-shadow 0.2s;
      }
      .demo-card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.4); }
      .demo-card h3 { margin-top: 0; color: #4a90e2; }
      .badge { 
        background: #4a90e2;
        color: #ffffff;
        padding: 2px 8px; 
        border-radius: 12px; 
        font-size: 12px; 
        margin-left: 8px;
      }
      pre { background: #2a2a2a; padding: 15px; border-radius: 4px; overflow-x: auto; color: #f0f0f0; }
      .github-link { 
        display: inline-block; 
        margin-top: 20px; 
        color: #4a90e2;
        text-decoration: none;
      }
      .github-link:hover { text-decoration: underline; }
      
      /* Demo Showcase Styles */
      .demo-showcase {
        display: flex;
        margin: 30px 0;
        border: 1px solid #444;
        border-radius: 8px;
        overflow: hidden;
      }
      .demo-tabs {
        width: 250px;
        background: #2a2a2a;
        border-right: 1px solid #444;
      }
      .demo-tab {
        padding: 15px;
        cursor: pointer;
        border-bottom: 1px solid #444;
        transition: background-color 0.2s;
      }
      .demo-tab:hover { background: #333; }
      .demo-tab.active {
        background: #383838;
        border-right: 2px solid #4a90e2;
      }
      .demo-tab h4 {
        margin: 0 0 8px;
        color: #4a90e2;
      }
      .demo-tab p {
        margin: 0;
        font-size: 14px;
        opacity: 0.8;
      }
      .demo-content {
        flex: 1;
        display: flex;
        flex-direction: column;
      }
      #editor-container {
        flex: 1;
        min-height: 400px;
      }
      .demo-controls {
        padding: 10px;
        background: #2a2a2a;
        border-top: 1px solid #444;
        display: flex;
        gap: 10px;
      }
      .demo-controls button {
        background: #4a90e2;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.2s;
      }
      .demo-controls button:hover { background: #357abd; }
      .demo-controls button:disabled { background: #2a2a2a; color: #666; cursor: not-allowed; }
    </style>
  </head>
  <body>
    <h1>üé• Monaco Recorder</h1>
    <p>A lightweight library for recording and replaying user interactions in Monaco Editor.</p>
    
    <h2>Live Demo</h2>
    <div class="demo-showcase">
      <div class="demo-tabs">
        <div class="demo-tab active" data-demo="js">
          <h4>JavaScript</h4>
          <p>Functions and array operations with console logging</p>
        </div>
        <div class="demo-tab" data-demo="ts">
          <h4>TypeScript</h4>
          <p>Interfaces, classes, and type-safe operations</p>
        </div>
        <div class="demo-tab" data-demo="react">
          <h4>React Hooks</h4>
          <p>React component with state and effect hooks</p>
        </div>
        <div class="demo-tab" data-demo="node">
          <h4>Node.js</h4>
          <p>File system and async/await operations</p>
        </div>
      </div>
      <div class="demo-content">
        <div id="editor-container"></div>
        <div class="demo-controls">
          <button id="play-btn">‚ñ∂Ô∏è Play</button>
          <button id="pause-btn" disabled>‚è∏Ô∏è Pause</button>
          <button id="restart-btn">üîÑ Restart</button>
        </div>
      </div>
    </div>

    <h2>Interactive Demos</h2>
    <div class="demo-grid">
      <a href="demos/recorder.html" class="demo-card">
        <h3>Unified Recorder (JS/TS) <span class="badge">Record & Play</span></h3>
        <p>Single page to record and playback in JavaScript or TypeScript. Includes Play/Pause, Stop, Speed slider, Threshold, and Import/Export.</p>
      </a>

      <a href="demos/vanilla.html" class="demo-card">
        <h3>Vanilla JavaScript <span class="badge">Basic</span></h3>
        <p>Pure JavaScript implementation showing the core recording and playback functionality. Perfect for understanding the basics.</p>
      </a>
      
      <a href="demos/react.html" class="demo-card">
        <h3>React Integration <span class="badge">Framework</span></h3>
        <p>React component example with hooks showing how to integrate monaco-recorder into a React application.</p>
      </a>
    </div>

    <h2>Quick Start</h2>
    <pre><code># Install
npm install monaco-recorder

# Import and use
import createMonacoRecorder from 'monaco-recorder';

const recorder = createMonacoRecorder(editor, monaco);
const stop = recorder.start();
// ... user interactions ...
const events = stop();
recorder.play(events);</code></pre>

    <h2>Features</h2>
    <ul>
      <li>üéØ <strong>Zero Build</strong> - Pure ES modules, no build step required</li>
      <li>üì¶ <strong>Framework Agnostic</strong> - Works with any JavaScript framework</li>
      <li>‚ö° <strong>Lightweight</strong> - No dependencies beyond Monaco Editor</li>
      <li>üîß <strong>TypeScript Support</strong> - Full type definitions included</li>
      <li>üéõÔ∏è <strong>Configurable</strong> - Control recording options and playback speed</li>
      <li>üíæ <strong>Serializable</strong> - Save recordings as JSON</li>
    </ul>

    <h2>Links</h2>
    <a href="https://github.com/WinstonFassett/monaco-recorder" class="github-link">
      üìö View on GitHub
    </a> |
    <a href="https://www.npmjs.com/package/monaco-recorder" class="github-link">
      üì¶ NPM Package
    </a> |
    <a href="https://github.com/WinstonFassett/monaco-recorder#readme" class="github-link">
      üìñ Documentation
    </a>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs/loader.js"></script>
    <script type="module">
      const playConfig = {
        speed: 3,
        minDelayMs: 0,
        maxDelayMs: 400
      };
      require.config({ 
        paths: { 
          vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs'
        }
      });

      window.MonacoEnvironment = {
        getWorkerUrl: function(moduleId, label) {
          const base = 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs';
          if (label === 'typescript' || label === 'javascript') {
            return `${base}/language/typescript/ts.worker.js`;
          }
          return `${base}/base/worker/workerMain.js`;
        }
      };

      // Ensure TypeScript worker is loaded
      const tsWorkerUrl = 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs/language/typescript/ts.worker.js';
      const script = document.createElement('script');
      script.src = tsWorkerUrl;
      document.head.appendChild(script);


      let editor, recorder, currentDemo = 'js';
      const demos = {
        js: '/recordings/samples/basic-usage.json',
        ts: '/recordings/samples/typescript.json',
        react: '/recordings/samples/react-integration.json',
        node: '/recordings/samples/node-example.json'
      };

      const demoLanguages = {
        js: 'javascript',
        ts: 'typescript',
        react: 'javascript',
        node: 'javascript'
      };

      require(['vs/editor/editor.main'], async function() {
        // Configure TypeScript
        monaco.languages.typescript.typescriptDefaults.setCompilerOptions({
          target: monaco.languages.typescript.ScriptTarget.ESNext,
          module: monaco.languages.typescript.ModuleKind.ESNext,
          moduleResolution: monaco.languages.typescript.ModuleResolutionKind.NodeJs,
          allowJs: true,
          allowNonTsExtensions: true,
          allowSyntheticDefaultImports: true,
          noEmit: true,
          lib: ['esnext', 'dom'],
          typeRoots: ['file:///node_modules/@types']
        });

        monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({
          noSemanticValidation: false,
          noSyntaxValidation: false,
          noSuggestionDiagnostics: false,
          diagnosticCodesToIgnore: [8006]
        });

        // Add basic TypeScript types
        monaco.languages.typescript.typescriptDefaults.addExtraLib(
          'declare module "*.ts" { const content: any; export default content; }',
          'file:///ambient.d.ts'
        );
        editor = monaco.editor.create(document.getElementById('editor-container'), {
          value: '// Loading demo...',
          language: 'javascript',
          theme: 'vs-dark',
          minimap: { enabled: false },
          fontSize: 14,
          lineNumbers: 'on',
          renderLineHighlight: 'all',
          scrollBeyondLastLine: false
        });

        const { createMonacoRecorder } = await import('./monaco-recorder.js');
        recorder = createMonacoRecorder(editor, monaco);
        loadDemo('js');
      });

      async function loadDemo(demoId) {
        try {
          const response = await fetch(demos[demoId]);
          const text = await response.text();
          let recording;
          
          // Set the appropriate language for the editor
          const language = demoLanguages[demoId] || 'javascript';
          
          // Parse recording and get initial content
          recording = JSON.parse(text);
          const initialContent = recording[0]?.content || '// Loading demo...';
          
          // Create a new model with the correct language
          const oldModel = editor.getModel();
          if (oldModel) {
            oldModel.dispose();
          }

          // Create a new model with the correct language and extension
          const uri = monaco.Uri.parse(`file:///demo.${language === 'typescript' ? 'ts' : 'js'}`);
          const model = monaco.editor.createModel(
            initialContent,
            language,
            uri
          );

          // For TypeScript files, ensure proper configuration
          if (language === 'typescript') {
            monaco.languages.typescript.typescriptDefaults.setCompilerOptions({
              target: monaco.languages.typescript.ScriptTarget.ESNext,
              module: monaco.languages.typescript.ModuleKind.ESNext,
              moduleResolution: monaco.languages.typescript.ModuleResolutionKind.NodeJs,
              allowJs: true,
              allowNonTsExtensions: true,
              allowSyntheticDefaultImports: true,
              noEmit: true,
              lib: ['esnext', 'dom'],
              typeRoots: ['file:///node_modules/@types']
            });

            monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({
              noSemanticValidation: false,
              noSyntaxValidation: false,
              noSuggestionDiagnostics: false,
              diagnosticCodesToIgnore: [8006]
            });
          }

          editor.setModel(model);

          currentDemo = demoId;
          currentRecording = recording;
          document.querySelectorAll('.demo-tab').forEach(tab => {
            tab.classList.toggle('active', tab.dataset.demo === demoId);
          });
          recorder.play(recording, {
            ...playConfig,
            onDone: () => {
              playBtn.disabled = false;
              pauseBtn.disabled = true;
            }
          });
        } catch (error) {
          console.error('Error loading demo:', error);
        }
      }

      document.querySelectorAll('.demo-tab').forEach(tab => {
        tab.addEventListener('click', () => loadDemo(tab.dataset.demo));
      });

      const playBtn = document.getElementById('play-btn');
      const pauseBtn = document.getElementById('pause-btn');
      const restartBtn = document.getElementById('restart-btn');

      let currentRecording = null;
      
      playBtn.addEventListener('click', () => {
        if (!currentRecording) return;
        recorder.play(currentRecording, {
          ...playConfig,
          onDone: () => {
            playBtn.disabled = false;
            pauseBtn.disabled = true;
          }
        });
        playBtn.disabled = true;
        pauseBtn.disabled = false;
      });

      pauseBtn.addEventListener('click', () => {
        recorder.stopPlayback();
        playBtn.disabled = false;
        pauseBtn.disabled = true;
      });

      restartBtn.addEventListener('click', () => {
        recorder.stopPlayback();
        loadDemo(currentDemo);
        playBtn.disabled = false;
        pauseBtn.disabled = true;
      });
    </script>
  </body>
</html>