<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Monaco Recorder Demos</title>
  <style>
    :root {
      --primary: #4a90e2;
      --bg: #1e1e1e;
      --surface: #252526;
      --border: #444;
      --text: #f0f0f0;
    }
    
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      display: flex;
      flex-direction: column;
      height: 100vh;
    }
    
    .header {
      padding: 1rem;
      background: var(--surface);
      border-bottom: 1px solid var(--border);
    }
    
    .container {
      flex: 1;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      max-width: 1200px;
      margin: 0 auto;
      width: 100%;
    }
    
    .demo-container {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    
    .demo-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }
    
    .demo-title {
      font-size: 1.5rem;
      color: var(--primary);
      margin: 0;
    }
    
    .demo-description {
      margin: 0.5rem 0 1rem;
      color: #aaa;
    }
    
    .editor-container {
      flex: 1;
      border: 1px solid var(--border);
      border-radius: 4px;
      overflow: hidden;
    }
    
    .controls {
      display: flex;
      gap: 0.5rem;
      margin-top: 1rem;
    }
    
    button {
      background: var(--primary);
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      cursor: pointer;
    }
    
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .demo-list {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
      flex-wrap: wrap;
    }
    
    .demo-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 1rem;
      cursor: pointer;
      width: 200px;
    }
    
    .demo-card:hover {
      border-color: var(--primary);
    }
    
    .demo-card.active {
      border-color: var(--primary);
      box-shadow: 0 0 0 1px var(--primary);
    }
    
    .demo-card h3 {
      margin: 0 0 0.5rem;
      color: var(--primary);
    }
    
    .demo-card p {
      margin: 0;
      font-size: 0.9rem;
      color: #aaa;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>Monaco Recorder Demos</h1>
  </div>
  
  <div class="container">
    <div class="demo-container">
      <div class="demo-header">
        <div>
          <h2 class="demo-title" id="demoTitle">Select a demo</h2>
          <p class="demo-description" id="demoDescription">Choose a demo from the list below</p>
        </div>
        <div class="controls">
          <button id="prevBtn" disabled>Previous</button>
          <button id="nextBtn">Next</button>
        </div>
      </div>
      
      <div class="editor-container" id="editor"></div>
      
      <div class="controls">
        <button id="playPauseBtn">Play</button>
        <button id="stopBtn" disabled>Stop</button>
        <div style="flex: 1"></div>
        <div>Speed: 
          <select id="speedSelect">
            <option value="0.5">0.5x</option>
            <option value="1" selected>1x</option>
            <option value="2">2x</option>
            <option value="5">5x</option>
          </select>
        </div>
      </div>
    </div>
    
    <h3>Available Demos</h3>
    <div class="demo-list" id="demoList">
      <!-- Demo cards will be added here -->
    </div>
  </div>

  <script src="https://unpkg.com/monaco-editor@0.45.0/min/vs/loader.js"></script>
  <script>
    // Demo configurations
    const DEMOS = [
      {
        id: 'js',
        title: 'JavaScript',
        description: 'Array operations and functional programming with console logging',
        recording: 'samples/basic-usage.json',
        language: 'javascript'
      },
      {
        id: 'typescript',
        title: 'TypeScript',
        description: 'Interfaces, classes and type-safe programming',
        recording: 'samples/typescript.json',
        language: 'typescript'
      },
      {
        id: 'react',
        title: 'React Hooks',
        description: 'Modern React component with hooks and state management',
        recording: 'samples/react.json',
        language: 'javascript'
      },
      {
        id: 'node',
        title: 'Node.js',
        description: 'Async file operations and error handling',
        recording: 'samples/node-example.json',
        language: 'javascript'
      }
    ];
    
    // App state
    let editor;
    let currentDemoIndex = 0;
    let recorder;
    let currentRecording = null;
    
    // Initialize the app
    window.require.config({ paths: { vs: 'https://unpkg.com/monaco-editor@0.45.0/min/vs' }});
    window.require(['vs/editor/editor.main'], () => {
      initEditor();
      loadDemo(0);
      setupEventListeners();
      renderDemoList();
    });
    
    function initEditor() {
      editor = monaco.editor.create(document.getElementById('editor'), {
        value: '// Select a demo to begin\n',
        language: 'javascript',
        theme: 'vs-dark',
        minimap: { enabled: true },
        automaticLayout: true
      });
    }
    
    async function loadDemo(index) {
      if (index < 0 || index >= DEMOS.length) return;
      
      currentDemoIndex = index;
      const demo = DEMOS[index];
      
      // Update UI
      document.getElementById('demoTitle').textContent = demo.title;
      document.getElementById('demoDescription').textContent = demo.description;
      
      // Load recording first
      try {
        const response = await fetch(demo.recording);
        const recording = await response.json();
        
        // Initialize recorder with monaco
        if (recorder) {
          recorder.stopPlayback();
        }
        recorder = window.monacoRecorder.createMonacoRecorder(editor, monaco);
        
        // Get initial content from recording
        const initial = recording.find(e => e.type === 'initialState');
        if (initial && initial.content) {
          // Create new model with correct language
          const model = monaco.editor.createModel(initial.content, demo.language);
          if (editor.getModel()) {
            editor.getModel().dispose();
          }
          editor.setModel(model);
        }
        
        // Store recording for playback
        currentRecording = recording;
        recorder.stopPlayback();
        
        // Enable controls
        document.getElementById('playPauseBtn').disabled = false;
        document.getElementById('stopBtn').disabled = true;
        
      } catch (error) {
        console.error('Failed to load demo:', error);
        document.getElementById('playPauseBtn').disabled = true;
        document.getElementById('stopBtn').disabled = true;
      }
      
      // Update navigation
      document.getElementById('prevBtn').disabled = index === 0;
      document.getElementById('nextBtn').disabled = index === DEMOS.length - 1;
      
      // Update active demo card
      document.querySelectorAll('.demo-card').forEach((card, i) => {
        if (i === index) {
          card.classList.add('active');
        } else {
          card.classList.remove('active');
        }
      });
    }
    
    async function loadRecording(recordingPath) {
      try {
        const response = await fetch(recordingPath);
        const events = await response.json();
        
        // Initialize recorder
        recorder = window.monacoRecorder.createMonacoRecorder(editor, monaco);
        
        // Set up the recording for playback
        recorder.setPlaybackSpeed(parseFloat(document.getElementById('speedSelect').value));
        recorder.loadEvents(events);
        
        // Set up event listeners
        // Set up event listeners for playback
        recorder.onPlaybackStarted(() => {
          document.getElementById('playPauseBtn').textContent = 'Pause';
          document.getElementById('stopBtn').disabled = false;
        });
        
        recorder.onPlaybackPaused(() => {
          document.getElementById('playPauseBtn').textContent = 'Resume';
        });
        
        recorder.onPlaybackFinished(() => {
          document.getElementById('playPauseBtn').textContent = 'Play';
          document.getElementById('stopBtn').disabled = true;
        });
        
        // Enable playback controls
        document.getElementById('playPauseBtn').disabled = false;
        
      } catch (error) {
        console.error('Failed to load recording:', error);
        recorder = window.monacoRecorder.createMonacoRecorder(editor, monaco);
        document.getElementById('playPauseBtn').disabled = true;
        document.getElementById('stopBtn').disabled = true;
      }
    }
    
    function renderDemoList() {
      const demoList = document.getElementById('demoList');
      demoList.innerHTML = '';
      
      DEMOS.forEach((demo, index) => {
        const card = document.createElement('div');
        card.className = 'demo-card' + (index === currentDemoIndex ? ' active' : '');
        card.innerHTML = `
          <h3>${demo.title}</h3>
          <p>${demo.description}</p>
        `;
        card.addEventListener('click', () => loadDemo(index));
        demoList.appendChild(card);
      });
    }
    
    function setupEventListeners() {
      // Navigation
      document.getElementById('prevBtn').addEventListener('click', () => {
        loadDemo(currentDemoIndex - 1);
      });
      
      document.getElementById('nextBtn').addEventListener('click', () => {
        loadDemo(currentDemoIndex + 1);
      });
      
      // Playback controls
      document.getElementById('playPauseBtn').addEventListener('click', () => {
        if (!recorder || !currentRecording) return;
        
        if (recorder.isPlaying()) {
          recorder.stopPlayback();
          document.getElementById('playPauseBtn').textContent = 'Play';
          document.getElementById('stopBtn').disabled = true;
        } else {
          recorder.play(currentRecording, {
            speed: parseFloat(document.getElementById('speedSelect').value) * 100,
            onDone: () => {
              document.getElementById('playPauseBtn').textContent = 'Play';
              document.getElementById('stopBtn').disabled = true;
            }
          });
          document.getElementById('playPauseBtn').textContent = 'Pause';
          document.getElementById('stopBtn').disabled = false;
        }
      });
      
      document.getElementById('stopBtn').addEventListener('click', () => {
        if (recorder) {
          recorder.stopPlayback();
        }
      });
      
      // Speed control
      document.getElementById('speedSelect').addEventListener('change', (e) => {
        if (recorder && currentRecording && recorder.isPlaying()) {
          recorder.stopPlayback();
          recorder.play(currentRecording, {
            speed: parseFloat(e.target.value) * 100,
            onDone: () => {
              document.getElementById('playPauseBtn').textContent = 'Play';
              document.getElementById('stopBtn').disabled = true;
            }
          });
        }
      });
    }
  </script>
</body>
</html>
